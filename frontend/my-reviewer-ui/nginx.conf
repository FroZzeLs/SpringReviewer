server {
    listen 80;
    # Возможно, другие директивы server_name и т.д.

    # Эта секция отвечает за отдачу статических файлов вашего фронтенда (React, Vue, Angular и т.д.)
    location / {
        root   /usr/share/nginx/html; # Путь, куда скопировались файлы из /app/dist
        index  index.html index.htm;
        # Эта строка важна для Single Page Applications (SPA), чтобы все запросы шли на index.html
        try_files $uri $uri/ /index.html;
    }

    # --- ВОТ КЛЮЧЕВАЯ СЕКЦИЯ ---
    # Эта секция должна перехватывать все запросы, начинающиеся с /api/
    # и перенаправлять их на ваш бэкенд-сервис
    location /api/ {
        # 'backend' - это имя сервиса бэкенда в вашем docker-compose.yml
        # 8080 - это порт, который слушает ваш бэкенд *внутри* сети Docker
        proxy_pass http://backend:8080/; # Указываем адрес бэкенда

        # Рекомендуемые заголовки для проксирования
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_read_timeout 180s; # Опционально: увеличить таймаут
        proxy_connect_timeout 180s; # Опционально: увеличить таймаут
    }

    # Опционально: Обработка ошибок Nginx
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }
}